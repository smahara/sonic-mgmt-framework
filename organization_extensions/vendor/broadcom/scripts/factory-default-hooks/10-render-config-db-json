# Render the config_db.json.j2 template if defined
CONFIG_PROFILES_BASE=/usr/share/broadcom_sonic/config_profiles
if [ -d ${CONFIG_PROFILES_BASE} ]; then
    ACTIVE_PROFILE_FLAG=${CONFIG_PROFILES_BASE}/active
    CONFIG_DB_TEMPLATE=${CONFIG_PROFILES_BASE}/$(cat ${ACTIVE_PROFILE_FLAG})/templates/config_db.json.j2

    PLATFORM=`sonic-cfggen -H -v DEVICE_METADATA.localhost.platform`
    PRESET=(`head -n 1 /usr/share/sonic/device/$PLATFORM/default_sku`)
    HW_KEY=${PRESET[0]}


    if [ -f ${CONFIG_DB_TEMPLATE} ] && [ "${HW_KEY}" != "" ]; then
        sonic-cfggen -H -k ${HW_KEY} -p -t ${CONFIG_DB_TEMPLATE} > /etc/sonic/config_db.json
        exit_status=$rv
    else
        exit_status=1
    fi
fi
